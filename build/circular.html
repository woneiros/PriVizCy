<!-- START SIGMA IMPORTS -->
<script src="sigma/src/sigma.core.js"></script>
<script src="sigma/src/conrad.js"></script>
<script src="sigma/src/utils/sigma.utils.js"></script>
<script src="sigma/src/utils/sigma.polyfills.js"></script>
<script src="sigma/src/sigma.settings.js"></script>
<script src="sigma/src/classes/sigma.classes.dispatcher.js"></script>
<script src="sigma/src/classes/sigma.classes.configurable.js"></script>
<script src="sigma/src/classes/sigma.classes.graph.js"></script>
<script src="sigma/src/classes/sigma.classes.camera.js"></script>
<script src="sigma/src/classes/sigma.classes.quad.js"></script>
<script src="sigma/src/classes/sigma.classes.edgequad.js"></script>
<script src="sigma/src/captors/sigma.captors.mouse.js"></script>
<script src="sigma/src/captors/sigma.captors.touch.js"></script>
<script src="sigma/src/renderers/sigma.renderers.canvas.js"></script>
<script src="sigma/src/renderers/sigma.renderers.webgl.js"></script>
<script src="sigma/src/renderers/sigma.renderers.svg.js"></script>
<script src="sigma/src/renderers/sigma.renderers.def.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.nodes.def.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.nodes.fast.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.edges.def.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.edges.fast.js"></script>
<script src="sigma/src/renderers/webgl/sigma.webgl.edges.arrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.labels.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.hovers.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.nodes.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.curve.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.arrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edges.curvedArrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.def.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.curve.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.arrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.edgehovers.curvedArrow.js"></script>
<script src="sigma/src/renderers/canvas/sigma.canvas.extremities.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.utils.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.nodes.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.edges.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.edges.curve.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.labels.def.js"></script>
<script src="sigma/src/renderers/svg/sigma.svg.hovers.def.js"></script>
<script src="sigma/src/middlewares/sigma.middlewares.rescale.js"></script>
<script src="sigma/src/middlewares/sigma.middlewares.copy.js"></script>
<script src="sigma/src/misc/sigma.misc.animation.js"></script>
<script src="sigma/src/misc/sigma.misc.bindEvents.js"></script>
<script src="sigma/src/misc/sigma.misc.bindDOMEvents.js"></script>
<script src="sigma/src/misc/sigma.misc.drawHovers.js"></script>
<!-- END SIGMA IMPORTS -->
<script src="sigma/plugins/sigma.parsers.gexf/gexf-parser.js"></script>
<script src="sigma/plugins/sigma.parsers.gexf/sigma.parsers.gexf.js"></script>
<script src="sigma/plugins/sigma.plugins.filter/sigma.plugins.filter.js"></script>
<!-- <script src="sigma/plugins/sigma.plugins.dragNodes/sigma.plugins.dragNodes.js"></script> -->
<link href='http://fonts.googleapis.com/css?family=Lato:300,700' rel='stylesheet' type='text/css'>
<div id="container">
  <style>
    body {
      color: #333;
      font-size: 14px;
      font-family: Lato, sans-serif;
    }
    #graph-container {
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      position: absolute;
    }
    #control-pane {
      top: 10px;
      /*bottom: 10px;*/
      right: 10px;
      position: absolute;
      width: 230px;
      background-color: rgb(249, 247, 237);
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    #control-pane > div {
      margin: 10px;
      overflow-x: auto;
    }
    .line {
      clear: both;
      display: block;
      width: 100%;
      margin: 0;
      padding: 12px 0 0 0;
      border-bottom: 1px solid #aac789;
      background: transparent;
    }
    h2, h3, h4 {
      padding: 0;
      font-variant: small-caps;
    }
    .green {
      color: #437356;
    }
    h2.underline {
      color: #437356;
      background: #f4f0e4;
      margin: 0;
      border-radius: 2px;
      padding: 8px 12px;
      font-weight: 700;
    }
    .hidden {
      display: none;
      visibility: hidden;
    }

    input[type=range] {
      width: 160px;
    }
  </style>
  <div id="graph-container"></div>
  <div id="control-pane">
    <h2 class="underline">filters</h2>

    <div>
      <h3>min degree <span id="min-degree-val">0</span></h3>
      0 <input id="min-degree" type="range" min="0" max="0" value="0"> <span id="max-degree-value">0</span><br>
    </div>
    <div>

    <fieldset id="demoButtons">
      <legend><strong>WEBSITE CATEGORIES</strong></legend>
        <input type="checkbox" name="category[]" checked value="News and Media" />News and Media <br />
        <input type="checkbox" name="category[]" checked value="Entertainment" />Entertainment<br />
        <input type="checkbox" name="category[]" checked value="Reference" />Reference<br />
        <input type="checkbox" name="category[]" checked value="Search Engines and Portals" />Search Engines and Portals<br />
        <input type="checkbox" name="category[]" checked value="Information Technology" />Information Technology<br />
        <input type="checkbox" name="category[]" checked value="Personal Websites and Blogs" />Personal Websites and Blogs<br />
        <input type="checkbox" name="category[]" checked value="Shopping" />Shopping<br />
        <input type="checkbox" name="category[]" checked value="Health and Wellness" />Health and Wellness<br />
        <input type="checkbox" name="category[]" checked value="Business" />Business<br />
        <input type="checkbox" name="category[]" checked value="Newsgroups and Message Boards" />Newsgroups and Message Boards<br />
        <input type="checkbox" name="category[]" checked value="Finance and Banking" />Finance and Banking<br />
        <input type="checkbox" name="category[]" checked value="Sports" />Sports<br />
        <input type="checkbox" name="category[]" checked value="Arts and Culture" />Arts and Culture<br />
        <input type="checkbox" name="category[]" checked value="Streaming Media" />Streaming Media<br />
        <input type="checkbox" name="category[]" checked value="File Sharing and Storage" />File Sharing and Storage<br />
        <input type="checkbox" name="category[]" checked value="Social Networking" />Social Networking<br />
        <input type="checkbox" name="category[]" checked value="Adult Materials" />Adult Materials<br />
        <input type="checkbox" name="category[]" checked value="Education" />Education<br />
        <input type="checkbox" name="category[]" checked value="Auction" />Auction<br />
        <input type="checkbox" name="category[]" checked value="Travel" />Travel<br />
        <input type="checkbox" name="category[]" checked value="Web Hosting" />Web Hosting<br />
        <input type="checkbox" name="category[]" checked value="Political Organizations" />Political Organizations<br />
        <input type="checkbox" name="category[]" checked value="Job Search" />Job Search<br />
    </fieldset>

    </div>
    <span class="line"></span>
    <div>
      <button id="reset-btn">Reset Filters</button>
      <button id="camera-btn">Reset Camera</button>
    </div>
    <div id="dump" class="hidden"></div>
  </div>
</div>
<script>
/**
 * This is an example on how to use sigma filters plugin on a real-world graph.
 */
var filter;
var node_classes = document.getElementsByName("category[]");

// Add the neighbors method
sigma.classes.graph.addMethod('neighbors', function(nodeId) {

  var neighbors = {};
  var _index = this.allNeighborsIndex[nodeId];

  return _index;

});

/**
 * DOM utility functions
 */
var _ = {
  $: function (id) {
    return document.getElementById(id);
  },

  all: function (selectors) {
    return document.querySelectorAll(selectors);
  },

  removeClass: function(selectors, cssClass) {
    var nodes = document.querySelectorAll(selectors);
    var l = nodes.length;
    for ( i = 0 ; i < l; i++ ) {
      var el = nodes[i];
      // Bootstrap compatibility
      el.className = el.className.replace(cssClass, '');
    }
  },

  addClass: function (selectors, cssClass) {
    var nodes = document.querySelectorAll(selectors);
    var l = nodes.length;
    for ( i = 0 ; i < l; i++ ) {
      var el = nodes[i];
      // Bootstrap compatibility
      if (-1 == el.className.indexOf(cssClass)) {
        el.className += ' ' + cssClass;
      }
    }
  },

  show: function (selectors) {
    this.removeClass(selectors, 'hidden');
  },

  hide: function (selectors) {
    this.addClass(selectors, 'hidden');
  },

  toggle: function (selectors, cssClass) {
    var cssClass = cssClass || "hidden";
    var nodes = document.querySelectorAll(selectors);
    var l = nodes.length;
    for ( i = 0 ; i < l; i++ ) {
      var el = nodes[i];
      //el.style.display = (el.style.display != 'none' ? 'none' : '' );
      // Bootstrap compatibility
      if (-1 !== el.className.indexOf(cssClass)) {
        el.className = el.className.replace(cssClass, '');
      } else {
        el.className += ' ' + cssClass;
      }
    }
  }
};


function updatePane (graph, filter) {
  // get max degree
  var maxDegree = 0,
      categories = {};

  // read nodes
  graph.nodes().forEach(function(n) {
    maxDegree = Math.max(maxDegree, graph.degree(n.id));
    categories[n.attributes.class] = true;
  })

  // min degree
  _.$('min-degree').max = maxDegree;
  _.$('max-degree-value').textContent = maxDegree;

  // Node classes
  var node_classes = document.getElementsByName("category[]");

  // reset button
  _.$('reset-btn').addEventListener("click", function(e) {
    _.$('min-degree').value = 0;
    _.$('min-degree-val').textContent = '0';

    for (var i=0; i < node_classes.length; i++) {
      node_classes[i].checked = true;
    }


    filter.undo().apply();
    _.$('dump').textContent = '';
    _.hide('#dump');
  });

}

// Initialize sigma with the dataset
sigma.parsers.gexf('data/circular.gexf', {
  container: 'graph-container',
  settings: {
    edgeColor: 'default',
    defaultEdgeColor: '#ccc'
  }
}, function(s) {
  // Record the "original" colors and position of nodes
  s.graph.nodes().forEach(function(n) {
    n.originalColor = n.color;
    n.originalx = n.x;
    n.originaly = n.y;
  });

  // Initialize the Filter API
  filter = new sigma.plugins.filter(s);

  // Node classes

  updatePane(s.graph, filter);

  function applyMinDegreeFilter(e) {
    var v = e.target.value;
    _.$('min-degree-val').textContent = v;

    filter
      .undo('min-degree')
      .nodesBy(function(n) {
        return this.degree(n.id) >= v;
      }, 'min-degree')
      .apply();
  }

  _.$('min-degree').addEventListener("input", applyMinDegreeFilter);  // for Chrome and FF
  _.$('min-degree').addEventListener("change", applyMinDegreeFilter); // for IE10+, that sucks


  // Reset camera button
  _.$('camera-btn').addEventListener("click", function(e) {
    s.camera.goTo({
      x: 0,
      y: 0,
      angle: 0,
      ratio: 1
    });
  });


  // CATEGORY FILTERS
  function applyWillFilter() {
    // get all values with true
    var show_values = [];
    for(var i=0; i < node_classes.length; i++) {
      if (node_classes[i].checked) {
        show_values.push(node_classes[i].value);
      }
    }

    // filter for only those who are in show_values
    filter
      .undo('node-category')
      .nodesBy(function(n) {
        return (show_values.indexOf(n.attributes.class) > -1);
      }, 'node-category')
      .apply();

  }

  // add onclick to each category filter
  for (var i = 0; i < node_classes.length; i++){
    node_classes[i].onclick = applyWillFilter;
  }


  // Bind the click event
  s.bind('clickNode', function(e) {
    var nodeId = e.data.node.id;
    var toKeep = s.graph.neighbors(nodeId);
    toKeep[nodeId] = e.data.node;

    // Highlight edges
    s.graph.nodes().forEach(function(n) {
      // Re-locate all nodes
      n.x = n.originalx;
      n.y = n.originaly;

      // Color accordingly
      if ( toKeep[n.label] ) {
        n.color = n.originalColor;
      }
      else {
        n.color = '#eee';
      }
    });

    // Highlight edges
    s.graph.edges().forEach(function(e) {
      if (nodeId === e.source || nodeId === e.target) {
        e.color = "rgb(190,190,190)";
      } else {
        e.color = "rgb(238,238,238)";
      }
    });

    // Center selected node
    e.data.node.x = 0;
    e.data.node.y = 0;

    s.refresh();

  });

  s.bind('clickStage', function(e) {
    s.graph.nodes().forEach(function(n) {
      // Re-color all nodes
      n.color = n.originalColor;

      // Re-locate all nodes
      n.x = n.originalx;
      n.y = n.originaly;
    });

    s.graph.edges().forEach(function(e) {
      // Re-color all nodes
      e.color = "rgb(238,238,238)";
    });

    s.refresh();
  });

});


</script>
